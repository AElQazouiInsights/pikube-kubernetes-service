<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ansible Control Node | PiKube Documentation</title>
    <meta name="description" content="Configuring an Ansible Control Node for our Raspberry Pi Kubernetes Cluster. The control node automates cluster configuration tasks using Ansible. Instructions include setting up the control node using a Docker container running on a Linux server, VM, or Windows Subsystem for Linux (WSL).">
    <meta name="generator" content="VitePress v1.5.0">
    <link rel="preload stylesheet" href="/pikube-kubernetes-service/assets/style.BEv0bWAg.css" as="style">
    <link rel="preload stylesheet" href="/pikube-kubernetes-service/vp-icons.css" as="style">
    
    <script type="module" src="/pikube-kubernetes-service/assets/app.BikVZpuP.js"></script>
    <link rel="preload" href="/pikube-kubernetes-service/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/pikube-kubernetes-service/assets/chunks/theme.CfwBPmUt.js">
    <link rel="modulepreload" href="/pikube-kubernetes-service/assets/chunks/framework.pWuaoOf3.js">
    <link rel="modulepreload" href="/pikube-kubernetes-service/assets/14-automation_1-ansible-control-node.md.BgH5xlp3.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/pikube-kubernetes-service/" data-v-1168a8e4><!--[--><!--]--><!--[--><img class="VPImage logo" src="/pikube-kubernetes-service/pi.svg" alt data-v-8426fc1a><!--]--><span data-v-1168a8e4>PiKube Documentation</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/pikube-kubernetes-service/" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/pikube-kubernetes-service/1-project-architecture-purpose/1-project-purpose.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>Docs</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/YourUsername/PiKube-Kubernetes-Cluster" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/YourUsername/PiKube-Kubernetes-Cluster" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>Project Architecture & Purpose</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/1-project-architecture-purpose/1-project-purpose.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Project Purpose</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/1-project-architecture-purpose/2-architecture.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Architecture</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed has-active" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>Automation</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/14-automation/1-ansible-control-node.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Ansible Control Node</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>Cluster Setup</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/2-cluster-setup/1-cluster-gateway-configuration.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Gateway Configuration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/2-cluster-setup/2-cluster-nodes-configuration.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Nodes Configuration</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>External Services</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/3-external-services/1-s3-backup-backend-minio-setup.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>S3 Backup Backend (Minio)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/3-external-services/2-external-secret-management-vault.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>External Secret Management (Vault)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>Kubernetes</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/4-kubernetes/1-k3s-installation.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>K3s Installation</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>Networking</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/5-networking/1-k3s-networking.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>K3s Networking</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/5-networking/2-load-balancer-metal-lb.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Load Balancer (Metal LB)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/5-networking/3-ingress-controller-traefik.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Ingress Controller (Traefik)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/5-networking/4-ingress-controller-nginx.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Ingress Controller (Nginx)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>Certificate Management</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/6-certificate-management/1-tls-certificates-cert-manager.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>TLS Certificates (Cert-Manager)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>Single Sign-On</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/7-single-sign-on/1-sso-with-keycloak-and-oauth2-proxy.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>SSO with Keycloak and OAuth2 Proxy</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>Storage</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/8-storage/1-distributed-block-storage-longhorn.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Distributed Block Storage (Longhorn)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/8-storage/2-s3-object-storage-service-minio.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>S3 Object Storage Service (Minio)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>Monitoring & Observability</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/9-monitoring/2-observability-framework.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Observability Framework</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/9-monitoring/3-centralized-logging-solutions.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Centralized Logging Solutions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/9-monitoring/4-log-aggregation-loki.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Log Aggregation (Loki)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/9-monitoring/5-log-analytics-elasticsearch-kibana.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Log Analytics (Elasticsearch/Kibana)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/9-monitoring/6-log-collection-and-distribution-fluentbit-fluentd.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Log Collection (FluentBit/Fluentd)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/9-monitoring/7-monitoring-prometheus.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Monitoring (Prometheus)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/9-monitoring/8-distributed-tracing-tempo.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Distributed Tracing (Tempo)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><div class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><p class="text" data-v-b7550ba0>Backup</p><!----></div><!----></div></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>GitOps</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/11-gitops/1-gitops-with-argocd.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>GitOps with ArgoCD</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>Microservices</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/12-microservices/1-databases.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Databases</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/12-microservices/2-service-mesh-linkerd.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Service Mesh (Linkerd)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/12-microservices/4-kafka.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Kafka</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>Further Reading</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/13-further-reading/utilities.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Kubernetes Commands and Tools Guide</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/13-further-reading/kubernetes-networking-fundamentals.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Kubernetes Networking Fundamentals</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 collapsible collapsed" data-v-c40bc020 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h2 class="text" data-v-b7550ba0>Miscellaneous</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/0-definitions.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Definitions</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/pikube-kubernetes-service/2.7-ingress-controller-traefik.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>Additional Configurations</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _pikube-kubernetes-service_14-automation_1-ansible-control-node" data-v-39a288b8><div><h1 id="frontmatter-title" tabindex="-1">Ansible Control Node <a class="header-anchor" href="#frontmatter-title" aria-label="Permalink to &quot;{{ $frontmatter.title }}&quot;">â€‹</a></h1><p align="center"><img alt="ansible" src="data:image/svg+xml,%3csvg%20xmlns=&#39;http://www.w3.org/2000/svg&#39;%20viewBox=&#39;-97.62%20-147.24%20120%2060&#39;%20width=&#39;120&#39;%20height=&#39;60&#39;%3e%3cpath%20d=&#39;M-57.6-117.24A17.9%2017.9%200%200%201-75.5-99.341c-9.885%200-17.898-8.013-17.898-17.898s8.014-17.898%2017.898-17.898%2017.898%208.014%2017.898%2017.9&#39;%20fill=&#39;%231a1918&#39;/%3e%3cpath%20d=&#39;M-75.198-124.204l4.632%2011.432-6.996-5.51zm8.228%2014.065l-7.125-17.146c-.203-.494-.6-.756-1.104-.756s-.93.262-1.134.756l-7.82%2018.807h2.675l3.095-7.754%209.238%207.463c.372.3.64.436.988.436.698%200%201.308-.523%201.308-1.278%200-.123-.044-.318-.122-.528z&#39;%20fill=&#39;%23fff&#39;/%3e%3cpath%20d=&#39;M-33.068-111.886c-.185%200-.384-.047-.523-.234l-5.933-7.802v7.958h-1.353v-9.8c0-.4.323-.702.692-.702.215%200%20.4.063.538.25l5.917%207.786v-7.927h1.353v9.784a.68.68%200%200%201-.692.687m7.828.094c-1.352%200-2.767-.28-4.088-.78l.323-1.123c1.214.4%202.536.67%203.765.67%201.706%200%202.598-.608%202.598-1.466%200-.78-.692-1.17-3.074-2.294s-3.32-1.84-3.32-3.245c0-1.763%201.352-2.48%203.904-2.48%201.06%200%202.7.22%203.628.5l-.215%201.154a15.41%2015.41%200%200%200-3.382-.42c-1.798%200-2.536.343-2.536%201.202%200%20.842.538%201.2%203.058%202.372%202.66%201.233%203.335%201.857%203.335%203.137%200%201.857-1.753%202.778-3.996%202.778m7.044-10.587h1.398v10.392h-1.398zm10.74%205.565h-3.474v3.527h3.474c1.183%200%201.906-.75%201.906-1.795%200-.983-.753-1.732-1.906-1.732m-.677-4.494h-2.797v3.324h2.797c1.122%200%201.937-.718%201.937-1.717%200-.983-.707-1.607-1.937-1.607m.692%209.206h-4.18c-.4%200-.707-.312-.707-.702v-8.988a.71.71%200%200%201%20.707-.702h3.458c2.12%200%203.38%201.045%203.38%202.684%200%20.9-.523%201.716-1.322%202.2%201.184.36%201.983%201.342%201.983%202.528%200%201.654-1.367%202.98-3.32%202.98m7.4-.115c-.384%200-.7-.328-.7-.702v-9.7h1.4v9.128H6.24v1.264zm12.797.057c-2.86%200-4.58-1.06-4.58-3.2%200-1.014.57-1.982%201.676-2.434-.9-.562-1.353-1.358-1.353-2.232%200-1.935%201.492-2.856%204.3-2.856a16.61%2016.61%200%200%201%203.366.359l-.154%201.155c-1.168-.187-2.26-.296-3.32-.296-1.814%200-2.782.5-2.782%201.7%200%20.952.892%201.7%202.076%201.7h2.398a.59.59%200%200%201%20.599.593c0%20.343-.26.608-.6.608h-2.582c-1.353%200-2.213.67-2.213%201.7%200%201.513%201.398%201.966%203.15%201.966.953%200%202.244-.124%203.3-.374l.2%201.138a13.61%2013.61%200%200%201-3.459.469m-61.303-8.158l2.45%206.138-3.7-2.96zm4.352%207.552l-3.768-9.206c-.108-.265-.323-.406-.584-.406a.63.63%200%200%200-.6.406l-4.122%2010.373%201.4-.276%201.637-4.163%204.885%204.007c.197.16.338.234.523.234a.68.68%200%200%200%20.691-.687.93.93%200%200%200-.064-.283z&#39;%20fill=&#39;%231a1918&#39;/%3e%3c/svg%3e" width="60%" height="%"></p><p>This guide explains how to configure an Ansible Control Node for automating the setup and management of our PiKube Kubernetes Service. The control node, named <code>pikube-controller</code>, orchestrates configuration tasks using Ansible. You can set up the control node on a <code>Linux server</code>, a <code>VirtualBox VM</code>, or directly on your Windows laptop using <code>Windows Subsystem for Linux (WSL)</code>.</p><h2 id="choosing-your-control-node-environment" tabindex="-1">Choosing Your Control Node Environment <a class="header-anchor" href="#choosing-your-control-node-environment" aria-label="Permalink to &quot;Choosing Your Control Node Environment&quot;">â€‹</a></h2><p>You have multiple options for setting up your Ansible Control Node (<code>pikube-controller</code>):</p><ul><li><p><strong>Windows Subsystem for Linux (WSL)</strong>:</p><ul><li>Ideal for users on Windows who prefer a native Linux environment without the overhead of a virtual machine.</li></ul></li><li><p><strong>Ubuntu Desktop</strong>:</p><ul><li>Suitable for users running Ubuntu on their desktop machines.</li></ul></li><li><p><strong>VirtualBox VM</strong>:</p><ul><li>Provides an isolated environment, beneficial for testing and development.</li></ul></li><li><p><strong>Linux Server</strong>:</p><ul><li>Best for dedicated environments where resources are allocated specifically for Ansible tasks.</li></ul></li></ul><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>This guide primarily focuses on setting up the control node using WSL, but instructions can be adapted for other environments as needed.</p></div><h2 id="installing-ansible-runtime-environment" tabindex="-1">Installing Ansible Runtime Environment <a class="header-anchor" href="#installing-ansible-runtime-environment" aria-label="Permalink to &quot;Installing Ansible Runtime Environment&quot;">â€‹</a></h2><p>The Ansible Runtime Environment (<code>ansible-runner</code>) is encapsulated within a Docker container, ensuring consistency and ease of management.</p><h3 id="installing-docker" tabindex="-1">Installing Docker <a class="header-anchor" href="#installing-docker" aria-label="Permalink to &quot;Installing Docker&quot;">â€‹</a></h3><p>Following the official <a href="https://docs.docker.com/engine/install/ubuntu/" target="_blank" rel="noreferrer">documentation</a>.</p><ul><li>Uninstall old versions of docker</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> remove</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-engine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker.io</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containerd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> runc</span></span></code></pre></div><ul><li>Update package index and install prerequisites</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  apt-transport-https</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ca-certificates</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  gnupg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  lsb-release</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span></code></pre></div><ul><li>Add Dockerâ€™s Official GPG Key</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -fsSL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://download.docker.com/linux/ubuntu/gpg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gpg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dearmor</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/keyrings/docker-archive-keyring.gpg</span></span></code></pre></div><ul><li>Set up the stable repository</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsb_release</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -cs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">) stable&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/apt/sources.list.d/docker.list</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span></span></code></pre></div><ul><li>Install docker engine</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-ce</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-ce-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containerd.io</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span></code></pre></div><ul><li><p>Manage docker as a non-root user</p><ul><li><p>Create docker group</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> groupadd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span></code></pre></div></li><li><p>Add your user to docker group</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> usermod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -aG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $USER</span></span></code></pre></div></li><li><p>Apply group changes by login out and back in to apply the group membership changes</p></li></ul></li><li><p>Enable docker to start on boot</p></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> containerd.service</span></span></code></pre></div><ul><li><p>Configure docker daemon</p><ul><li><p>Edit file <code>/etc/docker/daemon.json</code></p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;exec-opts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;native.cgroupdriver=systemd&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;log-driver&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;json-file&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;log-opts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;max-size&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;100m&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;storage-driver&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;overlay2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;data-root&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/data/docker&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li><strong>Parameters</strong>: <ul><li><code>exec-opts</code>: Sets the cgroup driver to <code>systemd</code> for better integration with Kubernetes.</li><li><code>log-driver</code>: Configures Docker to use the <code>json-file</code> logging driver with a maximum log size.</li><li><code>storage-driver</code>: Uses <code>overlay2</code> for improved performance.</li><li><code>data-root</code>: (Optional) Changes the default storage directory to <code>/data/docker</code>.</li><li>Refer to the <a href="https://docs.docker.com/engine/reference/commandline/dockerd/#daemon-configuration-file" target="_blank" rel="noreferrer"><strong><code>documentation</code></strong></a> for all possible options.</li></ul></li></ul></li><li><p>Restart docker</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span></code></pre></div></li></ul></li></ul><h3 id="installing-docker-compose" tabindex="-1">Installing Docker Compose <a class="header-anchor" href="#installing-docker-compose" aria-label="Permalink to &quot;Installing Docker Compose&quot;">â€‹</a></h3><p>Docker Compose simplifies the management of multi-container Docker applications.</p><ul><li><p>Check latest version by visiting the <a href="https://github.com/docker/compose/releases" target="_blank" rel="noreferrer"><strong><code>Docker Compose Releases</code></strong></a> page to identify the latest version. Replace <code>v2.32.3</code> with the latest version if different.</p></li><li><p>Download docker compose binary</p></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://github.com/docker/compose/releases/download/v2.32.3/docker-compose-$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uname</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)-$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uname</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/docker-compose</span></span></code></pre></div><ul><li>Apply executable permissions</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/docker-compose</span></span></code></pre></div><ul><li><p>Verify installation</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --version</span></span></code></pre></div></li></ul><h3 id="creating-the-ansible-runner-docker-environment" tabindex="-1">Creating the Ansible-Runner Docker Environment <a class="header-anchor" href="#creating-the-ansible-runner-docker-environment" aria-label="Permalink to &quot;Creating the Ansible-Runner Docker Environment&quot;">â€‹</a></h3><p>The Ansible-Runner environment encapsulates all necessary tools and dependencies for executing Ansible playbooks.</p><h3 id="directory-structure" tabindex="-1">Directory Structure <a class="header-anchor" href="#directory-structure" aria-label="Permalink to &quot;Directory Structure&quot;">â€‹</a></h3><p>Ensure your project has the following directory and file structure:</p><div class="language-init vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">init</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ğŸ“</span></span>
<span class="line"><span>â”œâ”€â”€ ğŸ“ ansible-runner</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ ğŸ“ build</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ requirements.txt</span></span>
<span class="line"><span>â”‚   â”‚   â””â”€â”€ requirements.yaml</span></span>
<span class="line"><span>â”‚   â”‚   â””â”€â”€ ansible_runner_setup.yaml</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ ğŸ“ certbot</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ ğŸ“ config</span></span>
<span class="line"><span>â”‚   â”‚   â”œâ”€â”€ ğŸ“ log</span></span>
<span class="line"><span>â”‚   â”‚   â””â”€â”€ ğŸ“ work</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ docker-compose.yaml</span></span>
<span class="line"><span>â”‚   â”œâ”€â”€ Dockerfile</span></span>
<span class="line"><span>â”‚   â””â”€â”€ ğŸ“ runner</span></span>
<span class="line"><span>â”‚       â”œâ”€â”€ ğŸ“ .ssh</span></span>
<span class="line"><span>â”‚       â”œâ”€â”€ ğŸ“ .vault</span></span>
<span class="line"><span>â”‚       â”œâ”€â”€ ğŸ“ .gnugp</span></span>
<span class="line"><span>â”‚       â””â”€â”€ ğŸ“ scripts</span></span>
<span class="line"><span>â”‚           â”œâ”€â”€ generate_gpg_key.sh</span></span>
<span class="line"><span>â”‚           â””â”€â”€ generate_vault_password.sh</span></span>
<span class="line"><span>â”œâ”€â”€ğŸ“ ansible</span></span>
<span class="line"><span>    â”œâ”€â”€ ansible.cfg</span></span>
<span class="line"><span>    â”œâ”€â”€ inventory.yaml</span></span>
<span class="line"><span>    â”œâ”€â”€ ğŸ“ roles</span></span></code></pre></div><ul><li><p><code>ansible-runner</code> directory:</p><ul><li>Contains Docker image building and running files.</li><li>Hosts directories mounted as volumes when running the Docker container.</li></ul></li><li><p><code>ansible</code> directory:</p><ul><li>Follows a typical Ansible project structure with configurations, inventories, and roles.</li></ul></li></ul><h3 id="building-the-ansible-runner-docker-image" tabindex="-1">Building the Ansible-Runner Docker Image <a class="header-anchor" href="#building-the-ansible-runner-docker-image" aria-label="Permalink to &quot;Building the Ansible-Runner Docker Image&quot;">â€‹</a></h3><ul><li>Navigate to the <code>ansible-runner</code> directory</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ansible-runner</span></span></code></pre></div><ul><li>The <code>Dockerfile</code> sets up the Ansible environment with necessary dependencies.</li></ul><div class="language-dockerfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ghcr.io/helmfile/helmfile:v0.167.1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> helmfile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> python:3.10-slim</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ARG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANSIBLE_GALAXY_CLI_COLLECTION_OPTS=--ignore-certs</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ARG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANSIBLE_GALAXY_CLI_ROLE_OPTS=--ignore-certs</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Install system dependencies</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> apt-get update -qq &amp;&amp; \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    apt-get install -y sudo git apt-utils python3-pip pwgen gnupg &amp;&amp; \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    apt-get clean &amp;&amp; \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Upgrade pip and install Ansible</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pip3 install --upgrade pip setuptools</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pip3 install ansible-core ansible-runner certbot</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Add and install Python dependencies</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> build /build</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /build</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pip3 install -r requirements.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Install Ansible roles and collections</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ansible-galaxy role install $ANSIBLE_GALAXY_CLI_ROLE_OPTS -r requirements.yaml --roles-path </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/usr/share/ansible/roles&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ANSIBLE_GALAXY_DISABLE_GPG_VERIFY=1 ansible-galaxy collection install $ANSIBLE_GALAXY_CLI_COLLECTION_OPTS -r requirements.yaml --collections-path </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/usr/share/ansible/collections&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Configure Ansible Runner</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ansible-playbook ansible_runner_setup.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Copy helmfile binary</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">COPY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --from=helmfile /usr/local/bin/helmfile /usr/local/bin/helmfile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> USER runner</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ENV</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FOLDER /home/runner</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create a non-root user</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> groupadd $USER &amp;&amp; \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    useradd $USER -m -d $FOLDER -g $USER -s /bin/bash &amp;&amp; \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    echo $USER </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ALL=(ALL) NOPASSWD:ALL&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &gt;&gt; /etc/sudoers</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create necessary directories with proper permissions</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> for dir in \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      /runner \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      /var/lib/letsencrypt \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      /etc/letsencrypt \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      /var/log/letsencrypt ; \</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    do mkdir -p $dir &amp;&amp; chown $USER:$USER $dir &amp;&amp; chmod 775 $dir; done</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Switch to non-root user</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $USER</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Set environment variable for GPG</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">RUN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> echo </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;export GPG_TTY=$(tty)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &gt;&gt; /home/runner/.bashrc</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /runner</span></span></code></pre></div><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p><strong>Key Components</strong>:</p><ul><li><strong>Base Images</strong>: <ul><li><code>helmfile</code>: For managing Helm charts.</li><li><code>python:3.10-slim</code>: Lightweight Python environment.</li></ul></li><li><strong>Installed Packages</strong>: <ul><li><strong>System Dependencies</strong>: <code>sudo</code>, <code>git</code>, <code>pip</code>, <code>pwgen</code>, <code>gnupg</code>.</li><li><strong>Python Packages</strong>: <code>ansible-core</code>, <code>ansible-runner</code>, <code>certbot</code>, and additional dependencies from <code>requirements.txt</code>.</li></ul></li><li><strong>Ansible Configuration</strong>: <ul><li>Installs Ansible roles and collections defined in <code>requirements.yaml</code>.</li><li>Runs <code>ansible_runner_setup.yaml</code> to finalize setup.</li></ul></li><li>User Setup: <ul><li>Creates a non-root user <code>runner</code> with necessary permissions.</li></ul></li><li><strong>Helmfile Integration</strong>: <ul><li>Copies the <code>helmfile</code> binary for managing Helm charts.</li></ul></li></ul></div><ul><li>Build the Docker Image</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ansible-runner</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .</span></span></code></pre></div><h4 id="configuring-docker-compose" tabindex="-1">Configuring Docker Compose <a class="header-anchor" href="#configuring-docker-compose" aria-label="Permalink to &quot;Configuring Docker Compose&quot;">â€‹</a></h4><p>The <code>docker-compose.yaml</code> file manages the Ansible-Runner container.</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;3.8&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  ansible-runner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ansible-runner</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    command</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tail -f /dev/null</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ansible-runner</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">unless-stopped</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./../ansible:/runner</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./../kubernetes:/kubernetes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./runner/.gnupg:/home/runner/.gnupg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./runner/.vault:/home/runner/.vault</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./runner/.secrets:/home/runner/.secrets</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./runner/scripts:/home/runner/scripts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./runner/.ssh:/home/runner/.ssh</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./runner/.kube:/home/runner/.kube</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./certbot/log:/var/log/letsencrypt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./certbot/config:/etc/letsencrypt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">./certbot/work:/var/lib/letsencrypt</span></span></code></pre></div><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p><strong>Explanation</strong>:</p><ul><li><strong>Service</strong>: <code>ansible-runner</code></li><li><strong>Image</strong>: Built from the local <code>Dockerfile</code>.</li><li><strong>Command</strong>: Keeps the container running (<code>tail -f /dev/null</code>).</li><li><strong>Volumes</strong>: <ul><li>Mounts project directories and configuration files into the container for seamless access.</li></ul></li></ul></div><ul><li>Start the <code>ansible-runner</code> container:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker-compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --detach</span></span></code></pre></div><ul><li><p>Interacting with the <code>ansible-runner</code> container</p><ul><li>Execute commands</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ansible-runner</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">comman</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span></code></pre></div><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>Replace <code>&lt;command&gt;</code> with the desired command, e.g., <code>ansible-playbook playbook.yaml</code>.</p></div><ul><li>Access shell</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ansible-runner</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /bin/bash</span></span></code></pre></div></li></ul><h2 id="configuring-ansible" tabindex="-1">Configuring Ansible <a class="header-anchor" href="#configuring-ansible" aria-label="Permalink to &quot;Configuring Ansible&quot;">â€‹</a></h2><p>Proper configuration ensures that Ansible operates smoothly and targets the correct hosts with appropriate variables.</p><h3 id="ansible-project-directory-structure" tabindex="-1">Ansible Project Directory Structure <a class="header-anchor" href="#ansible-project-directory-structure" aria-label="Permalink to &quot;Ansible Project Directory Structure&quot;">â€‹</a></h3><p>Organize your Ansible project following the <a href="https://docs.ansible.com/ansible/latest/tips_tricks/sample_setup.html#sample-directory-layout" target="_blank" rel="noreferrer">typical directory layout</a> to maintain clarity and scalability:</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ğŸ“ ansible</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">â”œâ”€â”€ ğŸ“ host_vars</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">â”œâ”€â”€ ğŸ“ group_vars</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">â”œâ”€â”€ ğŸ“ vars</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">â”œâ”€â”€ ğŸ“ tasks</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">â”œâ”€â”€ ğŸ“ templates</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">â”œâ”€â”€ ğŸ“ roles </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">â”œâ”€â”€ ansible.cfg</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">â”œâ”€â”€ inventory.yaml</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">â”œâ”€â”€ playbook1.yaml</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">â”œâ”€â”€ playbook2.yaml</span></span></code></pre></div><p><strong>Directory Descriptions</strong>:</p><ul><li><code>host_vars</code> and <code>group_vars</code>: <ul><li>Contain Ansible variables specific to individual hosts and host groups, respectively.</li></ul></li><li><code>vars</code>: <ul><li>Houses variable files used across multiple playbooks or roles.</li></ul></li><li><code>tasks</code>: <ul><li>Stores task files that define specific actions to be executed by playbooks.</li></ul></li><li><code>templates</code>: <ul><li>Contains Jinja2 template files used by playbooks for dynamic configuration file generation.</li></ul></li><li><code>roles</code>: <ul><li>Encapsulates reusable Ansible roles, each containing its own tasks, handlers, defaults, and more.</li></ul></li></ul><h3 id="ansible-configuration-file-ansible-cfg" tabindex="-1">Ansible Configuration File (ansible.cfg) <a class="header-anchor" href="#ansible-configuration-file-ansible-cfg" aria-label="Permalink to &quot;Ansible Configuration File (ansible.cfg)&quot;">â€‹</a></h3><p>The <code>ansible.cfg</code> file defines configuration settings for Ansible, such as paths to roles, collections, and the inventory file.</p><p>Create or edit the <code>ansible.cfg</code> file in your Ansible project directory (<code>~/ansible/ansible.cfg</code>) with the following content:</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[defaults]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Inventory file location</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">inventory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = ./inventory.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Number of parallel execution threads</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">forks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 5</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Paths to search for roles, separated by colon</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">roles_path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = ./roles:/usr/share/ansible/roles</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Paths to search for collections, separated by colon</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">collections_path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = ./collections:/usr/share/ansible/collections</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Disable SSH host key checking (use with caution)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">host_key_checking</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = false</span></span></code></pre></div><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>All Ansible commands (<code>ansible</code>, <code>ansible-galaxy</code>, <code>ansible-playbook</code>, <code>ansible-vault</code>) should be executed within the <code>~/ansible</code> directory in your WSL environment. This ensures that Ansible uses the configuration defined in <code>~/ansible/ansible.cfg</code>. Playbooks and related Ansible resources are expected to be launched from this directory.</p></div><h3 id="encrypting-secrets-and-key-variables" tabindex="-1">Encrypting Secrets and Key Variables <a class="header-anchor" href="#encrypting-secrets-and-key-variables" aria-label="Permalink to &quot;Encrypting Secrets and Key Variables&quot;">â€‹</a></h3><p><a href="https://docs.ansible.com/ansible/latest/user_guide/vault.html" target="_blank" rel="noreferrer">Ansible Vault</a> is utilized to encrypt sensitive information such as passwords, keys, and tokens within Ansible variable files.</p><p>To streamline the encryption and decryption process, all sensitive variables are stored in a dedicated file, <code>vars/vault.yaml</code>, which is encrypted using Ansible Vault.</p><p><strong><code>vault.yaml</code> Structure</strong></p><p>The vault.yaml file is a YAML file that contains a single variable <code>vault</code>, which is a dictionary holding all the necessary secrets.</p><p>Sample <code>vars/vault.yaml</code>:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">vault</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # K3s secrets</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  k3s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    k3s_token</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s1cret0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Traefik secrets</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  traefik</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    basic_auth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">admin</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      passwd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">s1cret0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Minio S3 secrets</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  minio</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    root</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">root</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">supers1cret0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    restic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">restic</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">supers1cret0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">...</span></span></code></pre></div><p><strong>Steps to Encrypt <code>vault.yaml</code></strong>:</p><ul><li><p>Edit <code>vars/vault.yaml</code> and populate the file with your own values for each key, password, or secret.</p></li><li><p>Execute the following command to encrypt the <code>vault.yaml</code> file</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ansible-vault</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> encrypt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vault.yaml</span></span></code></pre></div><ul><li><strong>Prompt</strong>: Enter a secure Ansible Vault password when prompted.</li><li><strong>Result</strong>: The <code>vault.yaml</code> file becomes encrypted and unreadable in plain text.</li></ul></li></ul><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><ul><li>To decrypt the file and view its contents:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ansible-vault</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> decrypt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vault.yaml</span></span></code></pre></div><ul><li>To view the contents without decrypting:</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ansible-vault</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> view</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vault.yaml</span></span></code></pre></div></div><h3 id="automate-ansible-vault-decryption-with-gpg" tabindex="-1">Automate Ansible Vault Decryption with GPG <a class="header-anchor" href="#automate-ansible-vault-decryption-with-gpg" aria-label="Permalink to &quot;Automate Ansible Vault Decryption with GPG&quot;">â€‹</a></h3><p>To avoid manually entering the Ansible Vault password each time you run playbooks, you can automate the decryption process using GPG encryption.</p><p><strong>Prerequisites</strong>:</p><ul><li><p>GnuPG is used to encrypt and decrypt the Ansible Vault passphrase securely.</p><ul><li><p>Install GnuPG:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gnupg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span></code></pre></div></li><li><p>Verify installation:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gpg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --help</span></span></code></pre></div></li><li><p>Generate a GPG Key Pair:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gpg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --full-generate-key</span></span></code></pre></div></li><li><p><strong>Process</strong>: Provide your name, email address, and a passphrase when prompted.</p></li><li><p><strong>Example Output</strong>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gpg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (GnuPG) 2.2.4; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Copyright</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (C) 2017 Free Software Foundation, Inc.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">This</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> free</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> software:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> are</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> free</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> change</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redistribute</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> it.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">There</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> NO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> WARRANTY,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> extent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> permitted</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> law.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GnuPG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> needs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> construct</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ID</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> identify</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Real</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Amine</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Email</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> quant-finance-hub@outlook.com</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">You</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> selected</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> this</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> USER-ID:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    &quot;Amine &lt;quant-finance-hub@outlook.com&gt;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Change</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (N)ame, (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">E</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)mail, or (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">O</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)kay/(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Q</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)uit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> O</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">We</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> need</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> random</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes.</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> It</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> good</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> idea</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> perform</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">some</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> other</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (type </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> keyboard,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> move</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mouse,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> utilize</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">disks</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) during the prime generation; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">this</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gives</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> random</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> number</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generator</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> better</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> chance</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gain</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enough</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> entropy.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gpg:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/quantstacker/.gnupg/trustdb.gpg:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trustdb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> created</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gpg:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> D59E854B5DD93199</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> marked</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ultimately</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trusted</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gpg:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> directory</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/home/quantstacker/.gnupg/openpgp-revocs.d&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> created</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gpg:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revocation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certificate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stored</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;/home/quantstacker/.gnupg/openpgp-revocs.d/A4745167B84C8C9A227DC898D59E854B5DD93199.rev&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">public</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> created</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> signed.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pub</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   rsa3072</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2021-08-13</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [SC] [expires: 2023-08-13]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      A4745167B84C8C9A227DC898D59E854B5DD93199</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      Amine</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">quant-finance-hub@outlook.co</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">m</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sub</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">   rsa3072</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2021-08-13</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [E] [expires: 2023-08-13]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Passphrase:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Provide</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> strong</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> passphrase</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secure</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> your</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GPG</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key.</span></span></code></pre></div></li><li><p><strong>Passphrase</strong>: Provide a strong passphrase to secure your GPG key.</p></li></ul></li><li><p>Generate and encrypt the Vault password</p><ul><li><p>Install <code>pwgen</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pwgen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span></code></pre></div></li><li><p>Generate a Vault password and encrypt with GPG</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/.vault</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pwgen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 71</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> head</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> gpg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --armor</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --recipient</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> quant-finance-hub@outlook.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/.vault/vault_passphrase.gpg</span></span></code></pre></div><ul><li>Replace <code>quant-finance-hub@outlook.com</code> with the email address associated with your GPG key.</li><li><strong>Result</strong>: The vault passphrase is encrypted and stored at <code>$HOME/.vault/vault_passphrase.gpg</code>.</li></ul></li></ul></li><li><p>Create a script that Ansible will use to decrypt the vault passphrase on the fly</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;#!/bin/sh</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">gpg --batch --use-agent --decrypt $HOME/.vault/vault_passphrase.gpg&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/.vault/vault_pass.sh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/.vault/vault_pass.sh</span></span></code></pre></div><ul><li><strong>Explanation</strong>: <ul><li>The script decrypts the vault passphrase using GPG when invoked.</li><li>Ensure the script has executable permissions.</li></ul></li></ul></li><li><p>Configure Ansible to use the Vault password file by editing your <code>ansible.cfg</code> file</p></li></ul><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[defaults]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">vault_password_file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = /home/quantstacker/.vault/vault_pass.sh</span></span></code></pre></div><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>Ensure the path points to the correct location of <code>vault_pass.sh</code> in your WSL environment.</p></div><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>If you have cloned this repository and steps 3 (Generate and Encrypt the Vault Password) and 4 (Create a Vault Password Script) are already completed, you can skip generating the vault password and script.</p></div><h4 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">â€‹</a></h4><ul><li><strong>Version Control</strong>: <ul><li>Do Not commit <code>vault.yaml</code> in its decrypted form to version control systems like Git.</li><li>Commit only the encrypted <code>vault.yaml</code> and ensure that the vault passphrase and GPG keys are securely stored and not tracked in version control.</li></ul></li><li>Secure GPG Keys: <ul><li>Protect your GPG private keys with strong passphrases.</li><li>Regularly back up your GPG keys to prevent loss.</li></ul></li><li><strong>Access Control</strong>: <ul><li>Limit access to the <code>~/.vault</code> directory and its contents to authorized users only.</li></ul></li></ul><h2 id="setting-up-ssh-keys-for-remote-connections" tabindex="-1">Setting Up SSH Keys for Remote Connections <a class="header-anchor" href="#setting-up-ssh-keys-for-remote-connections" aria-label="Permalink to &quot;Setting Up SSH Keys for Remote Connections&quot;">â€‹</a></h2><p>Secure and passwordless SSH access is essential for Ansible to manage remote nodes efficiently.</p><h3 id="generating-ssh-keys" tabindex="-1">Generating SSH Keys <a class="header-anchor" href="#generating-ssh-keys" aria-label="Permalink to &quot;Generating SSH Keys&quot;">â€‹</a></h3><p>Instead of using the default <code>id_rsa</code> and <code>id_rsa.pub</code> filenames, we&#39;ll generate SSH keys named <code>pikube-controller</code> and <code>pikube-controller.pub</code>. This naming convention clearly associates the keys with the <strong>Ansible-Controller</strong>.</p><ul><li><p><strong>On WSL</strong>:</p><ul><li><p>Generate a new SSH key pair with the desired name using the following command:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssh-keygen</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -b</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4096</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;pikube@ansible-controller&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/pikube-controller</span></span></code></pre></div></li><li><p><strong>Parameters</strong>:</p><ul><li><code>-t rsa</code>: Specifies the type of key to create (RSA).</li><li><code>-b 4096</code>: Defines the number of bits in the key for enhanced security.</li><li><code>-C &quot;pikube@ansible-controller&quot;</code>: Adds a comment, typically your email, for identification.</li><li><code>-f ~/.ssh/pikube-controller</code>: Specifies the filename for the generated key pair.</li></ul></li><li><p><strong>Interactive Prompts</strong>:</p><ul><li><p><strong>Enter passphrase (optional)</strong>: For added security, you can set a passphrase. Otherwise, press Enter to proceed without one.</p></li><li><p><strong>Enter same passphrase again</strong>: Confirm the passphrase if set.</p></li><li><p><strong>Output</strong>:</p><ul><li><strong>Private Key</strong>: <code>~/.ssh/pikube-controller</code></li><li><strong>Public Key</strong>: <code>~/.ssh/pikube-controller.pub</code></li></ul></li></ul></li></ul></li><li><p><strong>On Windows (using PuTTY)</strong>:</p><ul><li>Open <strong>PuTTYgen</strong>.</li><li>Click <strong>&quot;Generate&quot;</strong> and move the mouse cursor around to generate randomness.</li><li>Once generated, enter a <strong>Key Comment</strong> (e.g., <code>pikube@ansible-controller</code>) for identification.</li><li>(Optional) Enter a Key Passphrase for added security.</li><li>Click <strong>&quot;Save private key&quot;</strong> and name it <code>pikube-controller.ppk</code>.</li><li>Copy the Public Key from the PuTTYgen window or save it as <code>pikube-controller.pub</code>.</li><li>Convert to OpenSSH Format (Optional): <ul><li><p>If you prefer using OpenSSH keys within WSL, convert the PuTTY-generated keys:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">puttygen</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pikube-controller.ppk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> private-openssh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/pikube-controller</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">puttygen</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pikube-controller.ppk</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> public-openssh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.ssh/pikube-controller.pub</span></span></code></pre></div></li></ul></li></ul></li></ul><h3 id="configuring-ssh-access" tabindex="-1">Configuring SSH Access <a class="header-anchor" href="#configuring-ssh-access" aria-label="Permalink to &quot;Configuring SSH Access&quot;">â€‹</a></h3><p>Ensure that the content of <code>~/.ssh/pikube-controller.pub</code> is added to the ssh_authorized_keys field in the <code>user-data</code> files during the Ubuntu OS installation of each Raspberry Pi node.</p><p>Example <code>user-data</code> Configuration:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ssh_authorized_keys</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDsVSvxBitgaOiqeX4foCfhIe4yZj+OOaWP+wFuoUOBCZMWQ3cW188nSyXhXKfwYK50oo44O6UVEb2GZiU9bLOoy1fjfiGMOnmp3AUVG+e6Vh5aXOeLCEKKxV3I8LjMXr4ack6vtOqOVFBGFSN0ThaRTZwKpoxQ+pEzh+Q4cMJTXBHXYH0eP7WEuQlPIM/hmhGa4kIw/A92Rm0ZlF2H6L2QzxdLV/2LmnLAkt9C+6tH62hepcMCIQFPvHVUqj93hpmNm9MQI4hM7uK5qyH8wGi3nmPuX311km3hkd5O6XT5KNZq9Nk1HTC2GHqYzwha/cAka5pRUfZmWkJrEuV3sNAl pikube@ansible-controller</span></span></code></pre></div><h2 id="installing-ansible-development-environment-with-micromamba" tabindex="-1">Installing Ansible Development Environment with Micromamba <a class="header-anchor" href="#installing-ansible-development-environment-with-micromamba" aria-label="Permalink to &quot;Installing Ansible Development Environment with Micromamba&quot;">â€‹</a></h2><p>To establish a comprehensive Ansible development environment within WSL, the following setup is recommended:</p><ul><li><strong>Docker</strong>: Utilized by Molecule, Ansible&#39;s testing tool, for building testing environments.</li><li><strong>Vagrant and KVM</strong>: Employed by Molecule to automate the testing of roles that require virtual machines instead of Docker containers (e.g., Storage roles).</li><li><strong>Ansible and Molecule Packages</strong>: Managed using Micromamba, a lightweight and efficient environment manager, to ensure dependency isolation and reproducibility.</li></ul><h3 id="set-up-micromamba" tabindex="-1">Set Up Micromamba <a class="header-anchor" href="#set-up-micromamba" aria-label="Permalink to &quot;Set Up Micromamba&quot;">â€‹</a></h3><ul><li>Install Micromamba</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create a directory for Micromamba</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.micromamba/bin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Download Micromamba binary</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://micromamba.snakepit.net/api/micromamba/linux-64/latest</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -xvj</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.micromamba/bin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Create a symlink for easy access</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.micromamba/bin/micromamba</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.local/bin/micromamba</span></span></code></pre></div><ul><li>Initialize Micromamba to configure your shell</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">micromamba</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/micromamba</span></span></code></pre></div><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>Replace bash with your shell of choice if different (e.g., zsh).</p></div><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>To avoid typing multiple time <code>micromamba</code>, create an <code>alias</code> <code>mm</code> in <code>.bashrc</code></p></div><ul><li>To apply the changes, either restart your terminal or source your shell configuration</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">source</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/.bashrc</span></span></code></pre></div><ul><li>Create a new environment named <code>ansible</code> with Python 3.12</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">micromamba</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> create</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ansible-env</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> python=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3.12</span></span></code></pre></div><ul><li>Test the environement</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">micromamba</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> activate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ansible</span></span></code></pre></div><ul><li>With the environment activated, install <code>Ansible</code>, <code>Molecule</code>, and other necessary tools</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">micromamba</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> conda-forge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ansible</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> molecule</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yamllint</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ansible-lint</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jmespath</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> molecule-docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> molecule-vagrant</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><div class="edit-link" data-v-e257564d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/YourUsername/PiKube-Kubernetes-Cluster/edit/main/docs/14-automation/1-ansible-control-node.md" target="_blank" rel="noreferrer" data-v-e257564d><!--[--><span class="vpi-square-pen edit-link-icon" data-v-e257564d></span> Edit this page on GitHub<!--]--></a></div><!----></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/pikube-kubernetes-service/1-project-architecture-purpose/2-architecture.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>Architecture</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/pikube-kubernetes-service/2-cluster-setup/1-cluster-gateway-configuration.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>Gateway Configuration</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>Documentation licensed under MIT.</p><p class="copyright" data-v-e315a0ad>Copyright Â© 2024 Amine El Qazoui</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"0-definitions.md\":\"CMPDJgou\",\"1-project-architecture-purpose_1-project-purpose.md\":\"BkmRtVLd\",\"1-project-architecture-purpose_2-architecture.md\":\"C23QfBVT\",\"10-backup_1-backup-and-restore.md\":\"CYShiPSB\",\"11-gitops_1-gitops-with-argocd.md\":\"DXskaM_z\",\"12-microservices_1-databases.md\":\"CiS1dDG5\",\"12-microservices_2-service-mesh-linkerd.md\":\"CKMrc1ey\",\"12-microservices_4-kafka.md\":\"BLTjQg_H\",\"13-further-reading_kubernetes-networking-fundamentals.md\":\"BL3T-yDY\",\"13-further-reading_utilities.md\":\"CHjMT48p\",\"14-automation_1-ansible-control-node.md\":\"BgH5xlp3\",\"2-cluster-setup_1-cluster-gateway-configuration.md\":\"CLuwg2Hh\",\"2-cluster-setup_2-cluster-nodes-configuration.md\":\"B-35uUzW\",\"3-external-services_1-s3-backup-backend-minio-setup.md\":\"BxrXmsuM\",\"3-external-services_2-external-secret-management-vault.md\":\"De3m05fr\",\"4-kubernetes_1-k3s-installation.md\":\"DoLO9287\",\"5-networking_1-k3s-networking.md\":\"BABDhKjH\",\"5-networking_2-load-balancer-metal-lb.md\":\"BIcIjpnR\",\"5-networking_3-ingress-controller-traefik.md\":\"B53x7ElN\",\"5-networking_4-ingress-controller-nginx.md\":\"DIau5c0L\",\"6-certificate-management_1-tls-certificates-cert-manager.md\":\"Bz5b-uO7\",\"7-single-sign-on_1-sso-with-keycloak-and-oauth2-proxy.md\":\"DEgzvtqx\",\"8-storage_1-distributed-block-storage-longhorn.md\":\"m-UcNWYt\",\"8-storage_2-s3-object-storage-service-minio.md\":\"2uZCkNJT\",\"9-monitoring_2-observability-framework.md\":\"CNMyXSbJ\",\"9-monitoring_3-centralized-logging-solutions.md\":\"L4fAiHh8\",\"9-monitoring_4-log-aggregation-loki.md\":\"kpmZslP2\",\"9-monitoring_5-log-analytics-elasticsearch-kibana.md\":\"BZ3BBinT\",\"9-monitoring_6-log-collection-and-distribution-fluentbit-fluentd.md\":\"D1hpNHEX\",\"9-monitoring_7-monitoring-prometheus.md\":\"BgbvW4oD\",\"9-monitoring_8-distributed-tracing-tempo.md\":\"Imh2dl8-\",\"index.md\":\"zF1BI4mj\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"PiKube Documentation\",\"description\":\"Comprehensive documentation for the PiKube Kubernetes Service.\",\"base\":\"/pikube-kubernetes-service/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/pi.svg\",\"outline\":\"deep\",\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Docs\",\"link\":\"/1-project-architecture-purpose/1-project-purpose\"}],\"sidebar\":{\"/\":[{\"text\":\"Project Architecture & Purpose\",\"collapsed\":true,\"items\":[{\"text\":\"Project Purpose\",\"link\":\"/1-project-architecture-purpose/1-project-purpose\"},{\"text\":\"Architecture\",\"link\":\"/1-project-architecture-purpose/2-architecture\"}]},{\"text\":\"Automation\",\"collapsed\":true,\"items\":[{\"text\":\"Ansible Control Node\",\"link\":\"/14-automation/1-ansible-control-node\"}]},{\"text\":\"Cluster Setup\",\"collapsed\":true,\"items\":[{\"text\":\"Gateway Configuration\",\"link\":\"/2-cluster-setup/1-cluster-gateway-configuration\"},{\"text\":\"Nodes Configuration\",\"link\":\"/2-cluster-setup/2-cluster-nodes-configuration\"}]},{\"text\":\"External Services\",\"collapsed\":true,\"items\":[{\"text\":\"S3 Backup Backend (Minio)\",\"link\":\"/3-external-services/1-s3-backup-backend-minio-setup\"},{\"text\":\"External Secret Management (Vault)\",\"link\":\"/3-external-services/2-external-secret-management-vault\"}]},{\"text\":\"Kubernetes\",\"collapsed\":true,\"items\":[{\"text\":\"K3s Installation\",\"link\":\"/4-kubernetes/1-k3s-installation\"}]},{\"text\":\"Networking\",\"collapsed\":true,\"items\":[{\"text\":\"K3s Networking\",\"link\":\"/5-networking/1-k3s-networking\"},{\"text\":\"Load Balancer (Metal LB)\",\"link\":\"/5-networking/2-load-balancer-metal-lb\"},{\"text\":\"Ingress Controller (Traefik)\",\"link\":\"/5-networking/3-ingress-controller-traefik\"},{\"text\":\"Ingress Controller (Nginx)\",\"link\":\"/5-networking/4-ingress-controller-nginx\"}]},{\"text\":\"Certificate Management\",\"collapsed\":true,\"items\":[{\"text\":\"TLS Certificates (Cert-Manager)\",\"link\":\"/6-certificate-management/1-tls-certificates-cert-manager\"}]},{\"text\":\"Single Sign-On\",\"collapsed\":true,\"items\":[{\"text\":\"SSO with Keycloak and OAuth2 Proxy\",\"link\":\"/7-single-sign-on/1-sso-with-keycloak-and-oauth2-proxy\"}]},{\"text\":\"Storage\",\"collapsed\":true,\"items\":[{\"text\":\"Distributed Block Storage (Longhorn)\",\"link\":\"/8-storage/1-distributed-block-storage-longhorn\"},{\"text\":\"S3 Object Storage Service (Minio)\",\"link\":\"/8-storage/2-s3-object-storage-service-minio\"}]},{\"text\":\"Monitoring & Observability\",\"collapsed\":true,\"items\":[{\"text\":\"Observability Framework\",\"link\":\"/9-monitoring/2-observability-framework\"},{\"text\":\"Centralized Logging Solutions\",\"link\":\"/9-monitoring/3-centralized-logging-solutions\"},{\"text\":\"Log Aggregation (Loki)\",\"link\":\"/9-monitoring/4-log-aggregation-loki\"},{\"text\":\"Log Analytics (Elasticsearch/Kibana)\",\"link\":\"/9-monitoring/5-log-analytics-elasticsearch-kibana\"},{\"text\":\"Log Collection (FluentBit/Fluentd)\",\"link\":\"/9-monitoring/6-log-collection-and-distribution-fluentbit-fluentd\"},{\"text\":\"Monitoring (Prometheus)\",\"link\":\"/9-monitoring/7-monitoring-prometheus\"},{\"text\":\"Distributed Tracing (Tempo)\",\"link\":\"/9-monitoring/8-distributed-tracing-tempo\"}]},{\"text\":\"Backup\",\"collapsed\":true,\"items\":[]},{\"text\":\"GitOps\",\"collapsed\":true,\"items\":[{\"text\":\"GitOps with ArgoCD\",\"link\":\"/11-gitops/1-gitops-with-argocd\"}]},{\"text\":\"Microservices\",\"collapsed\":true,\"items\":[{\"text\":\"Databases\",\"link\":\"/12-microservices/1-databases\"},{\"text\":\"Service Mesh (Linkerd)\",\"link\":\"/12-microservices/2-service-mesh-linkerd\"},{\"text\":\"Kafka\",\"link\":\"/12-microservices/4-kafka\"}]},{\"text\":\"Further Reading\",\"collapsed\":true,\"items\":[{\"text\":\"Kubernetes Commands and Tools Guide\",\"link\":\"/13-further-reading/utilities\"},{\"text\":\"Kubernetes Networking Fundamentals\",\"link\":\"/13-further-reading/kubernetes-networking-fundamentals\"}]},{\"text\":\"Miscellaneous\",\"collapsed\":true,\"items\":[{\"text\":\"Definitions\",\"link\":\"/0-definitions\"},{\"text\":\"Additional Configurations\",\"link\":\"/2.7-ingress-controller-traefik\"}]}]},\"editLink\":{\"pattern\":\"https://github.com/YourUsername/PiKube-Kubernetes-Cluster/edit/main/docs/:path\",\"text\":\"Edit this page on GitHub\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/YourUsername/PiKube-Kubernetes-Cluster\"}],\"footer\":{\"message\":\"Documentation licensed under MIT.\",\"copyright\":\"Copyright Â© 2024 Amine El Qazoui\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>